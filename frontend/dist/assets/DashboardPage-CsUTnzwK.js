import{j as n}from"./ui-DIb4OZiY.js";import{e as k,a as i}from"./vendor-Dc3V-jfM.js";import{u as j,S as P}from"./Sidebar-Dvmsl6BE.js";import{u as T,E as $,M as B,C as D,A as F,c as L}from"./api-BXH5ywb-.js";import"./index-DIhOCUIk.js";function J(){const{conversationId:c}=k(),p=i.useRef(null),l=i.useRef(null),{conversations:d,activeConversationId:u,loadConversations:y,createConversation:h,selectConversation:E,addMessage:S,updateMessage:m,isStreaming:I,setStreaming:g,selectedModel:v}=j(),{artifacts:M,addArtifact:b}=T(),s=d.find(e=>e.id===u),w=()=>{var e;(e=p.current)==null||e.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{w()},[s==null?void 0:s.messages]),i.useEffect(()=>{y()},[]),i.useEffect(()=>{c&&c!==u&&E(c)},[c]),i.useEffect(()=>{!s&&d.length===0&&h()},[d.length]);const A=e=>M.filter(r=>r.messageId===e),x=async(e,r)=>{let o=u;o||(o=(await h()).id),S({role:"user",content:e});const a=S({role:"assistant",content:"",isStreaming:!0,model:v});g(!0);let f="";try{l.current=new AbortController;for await(const t of L(e,{conversationId:o??void 0,model:v,signal:l.current.signal}))if(t.type==="chunk"&&t.content)f+=t.content,m(a.id,f);else if(t.type==="artifact"&&t.artifact){const N=b({title:t.artifact.title,type:t.artifact.type,content:t.artifact.content,language:t.artifact.language,messageId:a.id});j.getState().addArtifactToMessage(a.id,N.id)}else t.type==="error"&&(f=`❌ ${t.error}`,m(a.id,f))}catch(t){t.name!=="AbortError"&&m(a.id,`❌ Erro: ${t.message}`)}finally{g(!1),l.current=null}},C=()=>{var e;(e=l.current)==null||e.abort(),g(!1)},R=async e=>{const r=(s==null?void 0:s.messages)||[],o=r.findIndex(a=>a.id===e);if(o>0){const a=r[o-1];a.role==="user"&&await x(a.content)}};return n.jsxs("div",{className:"h-screen flex bg-stone-50",children:[n.jsx(P,{}),n.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[n.jsx("div",{className:"flex-1 overflow-y-auto",children:!s||s.messages.length===0?n.jsx($,{onSuggestionClick:x}):n.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[s.messages.map((e,r)=>n.jsx(B,{message:e,artifacts:A(e.id),onRegenerate:e.role==="assistant"&&!e.isStreaming?()=>R(e.id):void 0},e.id)),n.jsx("div",{ref:p})]})}),n.jsx(D,{onSend:x,isLoading:I,onStop:C})]}),n.jsx(F,{})]})}export{J as DashboardPage};
