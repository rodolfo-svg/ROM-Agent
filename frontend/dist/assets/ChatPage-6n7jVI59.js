import{j as s}from"./ui-DIb4OZiY.js";import{e as T,a as c}from"./vendor-Dc3V-jfM.js";import{u as y,S as $}from"./Sidebar-CW8v-IBL.js";import{u as B,E as F,M as L,C as V,A as q,c as z}from"./api-B9HSOQlE.js";import"./index-D2MRyA27.js";function O(){const{conversationId:l}=T(),h=c.useRef(null),f=c.useRef(null),{conversations:d,activeConversationId:u,loadConversations:w,createConversation:v,selectConversation:E,addMessage:S,updateMessage:g,isStreaming:I,setStreaming:x,selectedModel:j}=y(),{artifacts:b,addArtifact:M}=B(),a=d.find(e=>e.id===u),C=()=>{var e;(e=h.current)==null||e.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{C()},[a==null?void 0:a.messages]),c.useEffect(()=>{w()},[]),c.useEffect(()=>{l&&l!==u&&E(l)},[l]),c.useEffect(()=>{!a&&d.length===0&&v()},[d.length]);const A=e=>b.filter(i=>i.messageId===e),p=async(e,i)=>{let o=u;o||(o=(await v()).id),S({role:"user",content:e});const n=S({role:"assistant",content:"",isStreaming:!0,model:j});x(!0);let m="";try{f.current=new AbortController;const r=d.find(t=>t.id===o),N=(r==null?void 0:r.messages.map(t=>({role:t.role,content:t.content})))||[];for await(const t of z(e,{conversationId:o,model:j,messages:N,signal:f.current.signal}))if(t.type==="chunk"&&t.content)m+=t.content,g(n.id,m);else if(t.type==="artifact"&&t.artifact){const P=M({title:t.artifact.title,type:t.artifact.type,content:t.artifact.content,language:t.artifact.language,messageId:n.id});y.getState().addArtifactToMessage(n.id,P.id)}else t.type==="error"&&(m=`❌ ${t.error}`,g(n.id,m))}catch(r){r.name!=="AbortError"&&g(n.id,`❌ Erro: ${r.message}`)}finally{x(!1),f.current=null}},R=()=>{var e;(e=f.current)==null||e.abort(),x(!1)},k=async e=>{const i=(a==null?void 0:a.messages)||[],o=i.findIndex(n=>n.id===e);if(o>0){const n=i[o-1];n.role==="user"&&await p(n.content)}};return s.jsxs("div",{className:"h-screen flex bg-stone-50 overflow-hidden",children:[s.jsx($,{}),s.jsxs("div",{className:"flex-1 flex flex-col min-w-0 max-md:w-full",children:[s.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain webkit-overflow-scrolling-touch pb-safe",children:!a||a.messages.length===0?s.jsx(F,{onSuggestionClick:p}):s.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 max-md:px-3 max-md:py-4",children:[a.messages.map((e,i)=>s.jsx(L,{message:e,artifacts:A(e.id),onRegenerate:e.role==="assistant"&&!e.isStreaming?()=>k(e.id):void 0},e.id)),s.jsx("div",{ref:h})]})}),s.jsx("div",{className:"flex-shrink-0 pb-safe",children:s.jsx(V,{onSend:p,isLoading:I,onStop:R})})]}),s.jsx(q,{})]})}export{O as ChatPage};
