import{j as n}from"./ui-DIb4OZiY.js";import{e as N,a as i}from"./vendor-Dc3V-jfM.js";import{u as j,S as k}from"./Sidebar-Dd7tJQ2R.js";import{u as P,E as T,M as $,C as B,A as D,c as F}from"./api-CFrXpBHL.js";import"./index-wjvp53lN.js";function H(){const{conversationId:c}=N(),x=i.useRef(null),l=i.useRef(null),{conversations:p,activeConversationId:d,createConversation:h,selectConversation:y,addMessage:S,updateMessage:u,isStreaming:I,setStreaming:m,selectedModel:v}=j(),{artifacts:E,addArtifact:M}=P(),s=p.find(e=>e.id===d),b=()=>{var e;(e=x.current)==null||e.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{b()},[s==null?void 0:s.messages]),i.useEffect(()=>{c&&c!==d&&y(c)},[c]),i.useEffect(()=>{!s&&p.length===0&&h()},[]);const w=e=>E.filter(r=>r.messageId===e),g=async(e,r)=>{let o=d;o||(o=(await h()).id),S({role:"user",content:e});const a=S({role:"assistant",content:"",isStreaming:!0,model:v});m(!0);let f="";try{l.current=new AbortController;for await(const t of F(e,{conversationId:o??void 0,model:v,signal:l.current.signal}))if(t.type==="chunk"&&t.content)f+=t.content,u(a.id,f);else if(t.type==="artifact"&&t.artifact){const R=M({title:t.artifact.title,type:t.artifact.type,content:t.artifact.content,language:t.artifact.language,messageId:a.id});j.getState().addArtifactToMessage(a.id,R.id)}else t.type==="error"&&(f=`❌ ${t.error}`,u(a.id,f))}catch(t){t.name!=="AbortError"&&u(a.id,`❌ Erro: ${t.message}`)}finally{m(!1),l.current=null}},A=()=>{var e;(e=l.current)==null||e.abort(),m(!1)},C=async e=>{const r=(s==null?void 0:s.messages)||[],o=r.findIndex(a=>a.id===e);if(o>0){const a=r[o-1];a.role==="user"&&await g(a.content)}};return n.jsxs("div",{className:"h-screen flex bg-stone-50",children:[n.jsx(k,{}),n.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[n.jsx("div",{className:"flex-1 overflow-y-auto",children:!s||s.messages.length===0?n.jsx(T,{onSuggestionClick:g}):n.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[s.messages.map((e,r)=>n.jsx($,{message:e,artifacts:w(e.id),onRegenerate:e.role==="assistant"&&!e.isStreaming?()=>C(e.id):void 0},e.id)),n.jsx("div",{ref:x})]})}),n.jsx(B,{onSend:g,isLoading:I,onStop:A})]}),n.jsx(D,{})]})}export{H as DashboardPage};
