import{j as a}from"./ui-DIb4OZiY.js";import{e as T,a as r}from"./vendor-Dc3V-jfM.js";import{u as w,S as $}from"./Sidebar-Dvmsl6BE.js";import{u as B,E as F,M as L,C as V,A as q,c as z}from"./api-BXH5ywb-.js";import"./index-DIhOCUIk.js";function O(){const{conversationId:d}=T(),p=r.useRef(null),m=r.useRef(null),{conversations:l,activeConversationId:i,loadConversations:E,createConversation:v,selectConversation:S,addMessage:j,updateMessage:u,isStreaming:I,setStreaming:x,selectedModel:y}=w(),{artifacts:b,addArtifact:M}=B(),s=l.find(t=>t.id===i),C=()=>{var t;(t=p.current)==null||t.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{C()},[s==null?void 0:s.messages]),r.useEffect(()=>{E()},[]),r.useEffect(()=>{d&&d!==i&&S(d)},[d]),r.useEffect(()=>{i&&s&&s.messages.length===0&&S(i)},[i,l.length]),r.useEffect(()=>{!s&&l.length===0&&v()},[l.length]);const A=t=>b.filter(c=>c.messageId===t),h=async(t,c)=>{let o=i;o||(o=(await v()).id);const n=l.find(e=>e.id===o),N=(n==null?void 0:n.messages.filter(e=>e.content&&e.content.trim()!=="").map(e=>({role:e.role,content:e.content})))||[];j({role:"user",content:t});const f=j({role:"assistant",content:"",isStreaming:!0,model:y});x(!0);let g="";try{m.current=new AbortController;for await(const e of z(t,{conversationId:o,model:y,messages:N,signal:m.current.signal}))if(e.type==="chunk"&&e.content)g+=e.content,u(f.id,g);else if(e.type==="artifact"&&e.artifact){const P=M({title:e.artifact.title,type:e.artifact.type,content:e.artifact.content,language:e.artifact.language,messageId:f.id});w.getState().addArtifactToMessage(f.id,P.id)}else e.type==="error"&&(g=`❌ ${e.error}`,u(f.id,g))}catch(e){e.name!=="AbortError"&&u(f.id,`❌ Erro: ${e.message}`)}finally{x(!1),m.current=null}},R=()=>{var t;(t=m.current)==null||t.abort(),x(!1)},k=async t=>{const c=(s==null?void 0:s.messages)||[],o=c.findIndex(n=>n.id===t);if(o>0){const n=c[o-1];n.role==="user"&&await h(n.content)}};return a.jsxs("div",{className:"h-screen flex bg-stone-50 overflow-hidden",children:[a.jsx($,{}),a.jsxs("div",{className:"flex-1 flex flex-col min-w-0 max-md:w-full",children:[a.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain webkit-overflow-scrolling-touch pb-safe",children:!s||s.messages.length===0?a.jsx(F,{onSuggestionClick:h}):a.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 max-md:px-3 max-md:py-4",children:[s.messages.map((t,c)=>a.jsx(L,{message:t,artifacts:A(t.id),onRegenerate:t.role==="assistant"&&!t.isStreaming?()=>k(t.id):void 0},t.id)),a.jsx("div",{ref:p})]})}),a.jsx("div",{className:"flex-shrink-0 pb-safe",children:a.jsx(V,{onSend:h,isLoading:I,onStop:R})})]}),a.jsx(q,{})]})}export{O as ChatPage};
