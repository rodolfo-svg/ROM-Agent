import{j as s}from"./ui-DIb4OZiY.js";import{e as P,a as c}from"./vendor-Dc3V-jfM.js";import{u as y,S as T}from"./Sidebar-CD9RWTOA.js";import{u as $,E as B,M as F,C as L,A as V,c as q}from"./api-B5j_Ehwe.js";import"./index-C1EpJtMS.js";function K(){const{conversationId:l}=P(),h=c.useRef(null),f=c.useRef(null),{conversations:m,activeConversationId:u,createConversation:v,selectConversation:w,addMessage:S,updateMessage:g,isStreaming:I,setStreaming:x,selectedModel:j}=y(),{artifacts:b,addArtifact:E}=$(),a=m.find(e=>e.id===u),M=()=>{var e;(e=h.current)==null||e.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{M()},[a==null?void 0:a.messages]),c.useEffect(()=>{l&&l!==u&&w(l)},[l]),c.useEffect(()=>{!a&&m.length===0&&v()},[]);const A=e=>b.filter(i=>i.messageId===e),p=async(e,i)=>{let o=u;o||(o=v().id),S({role:"user",content:e});const n=S({role:"assistant",content:"",isStreaming:!0,model:j});x(!0);let d="";try{f.current=new AbortController;const r=m.find(t=>t.id===o),k=(r==null?void 0:r.messages.map(t=>({role:t.role,content:t.content})))||[];for await(const t of q(e,{conversationId:o,model:j,messages:k,signal:f.current.signal}))if(t.type==="chunk"&&t.content)d+=t.content,g(n.id,d);else if(t.type==="artifact"&&t.artifact){const N=E({title:t.artifact.title,type:t.artifact.type,content:t.artifact.content,language:t.artifact.language,messageId:n.id});y.getState().addArtifactToMessage(n.id,N.id)}else t.type==="error"&&(d=`❌ ${t.error}`,g(n.id,d))}catch(r){r.name!=="AbortError"&&g(n.id,`❌ Erro: ${r.message}`)}finally{x(!1),f.current=null}},C=()=>{var e;(e=f.current)==null||e.abort(),x(!1)},R=async e=>{const i=(a==null?void 0:a.messages)||[],o=i.findIndex(n=>n.id===e);if(o>0){const n=i[o-1];n.role==="user"&&await p(n.content)}};return s.jsxs("div",{className:"h-screen flex bg-stone-50 overflow-hidden",children:[s.jsx(T,{}),s.jsxs("div",{className:"flex-1 flex flex-col min-w-0 max-md:w-full",children:[s.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain webkit-overflow-scrolling-touch pb-safe",children:!a||a.messages.length===0?s.jsx(B,{onSuggestionClick:p}):s.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 max-md:px-3 max-md:py-4",children:[a.messages.map((e,i)=>s.jsx(F,{message:e,artifacts:A(e.id),onRegenerate:e.role==="assistant"&&!e.isStreaming?()=>R(e.id):void 0},e.id)),s.jsx("div",{ref:h})]})}),s.jsx("div",{className:"flex-shrink-0 pb-safe",children:s.jsx(L,{onSend:p,isLoading:I,onStop:C})})]}),s.jsx(V,{})]})}export{K as ChatPage};
