import{j as e,D as k,Q as z,H as p,F as f,V as Q,h as H,Y as I,y as G}from"./ui-DIb4OZiY.js";import{u as J,a as d}from"./vendor-Dc3V-jfM.js";import{S as V,B as Y}from"./Sidebar-Dvmsl6BE.js";import{u as K}from"./index-DIhOCUIk.js";function q(){const{user:i}=K(),h=J(),o=(i==null?void 0:i.role)==="admin";d.useEffect(()=>{o||h("/dashboard")},[o,h]);const[b,j]=d.useState(!0),[m,N]=d.useState(null),[g,v]=d.useState(null),[a,w]=d.useState(null),[s,y]=d.useState(null),[n,R]=d.useState(null),[u,S]=d.useState([]),[r,U]=d.useState([]);d.useEffect(()=>{o&&D()},[o]);const D=async()=>{j(!0);try{const[t,l,c,x,T,A,B]=await Promise.all([fetch("/api/stats",{credentials:"include"}),fetch("/api/dashboard/usage",{credentials:"include"}),fetch("/api/dashboard/analytics",{credentials:"include"}),fetch("/api/dashboard/quality",{credentials:"include"}),fetch("/api/dashboard/billing",{credentials:"include"}),fetch("/api/dashboard/users",{credentials:"include"}),fetch("/api/dashboard/pieces",{credentials:"include"})]),P=await t.json(),$=await l.json(),F=await c.json(),M=await x.json(),E=await T.json(),L=await A.json(),O=await B.json();N(P),v($.usage||{daily:[],weekly:[],monthly:[]}),w(F.analytics||{topPrompts:[],topUsers:[],peakHours:[]}),y(M.quality||{averageResponseTime:0,successRate:0,errorRate:0}),R(E.billing||{totalCost:0,costByModel:[],costByUser:[]}),S(L.users||[]),U(O.pieces||[])}catch(t){console.error("Failed to fetch reports data:",t)}finally{j(!1)}},C=()=>{const t={stats:m,usage:g,analytics:a,quality:s,billing:n,users:u,pieces:r,exportedAt:new Date().toISOString(),exportedBy:i==null?void 0:i.email},l=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),c=URL.createObjectURL(l),x=document.createElement("a");x.href=c,x.download=`rom-agent-report-${new Date().toISOString().split("T")[0]}.json`,x.click(),URL.revokeObjectURL(c)};return o?e.jsxs("div",{className:"h-screen flex bg-stone-50",children:[e.jsx(V,{}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"bg-white border-b border-stone-200 px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-stone-800 mb-2",children:"Relatórios e Analytics"}),e.jsx("p",{className:"text-stone-500",children:"Métricas de uso e desempenho do sistema"})]}),e.jsxs(Y,{onClick:C,className:"gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Exportar Relatório"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-bronze-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-stone-500",children:"Carregando relatórios..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(z,{className:"w-6 h-6 text-blue-600"})})}),e.jsx("h3",{className:"text-2xl font-bold text-stone-800 mb-1",children:(m==null?void 0:m.totalConversations)||0}),e.jsx("p",{className:"text-sm text-stone-500",children:"Total de Conversas"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6 text-green-600"})})}),e.jsx("h3",{className:"text-2xl font-bold text-stone-800 mb-1",children:u.length}),e.jsx("p",{className:"text-sm text-stone-500",children:"Usuários Ativos"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-purple-600"})})}),e.jsx("h3",{className:"text-2xl font-bold text-stone-800 mb-1",children:r.length}),e.jsx("p",{className:"text-sm text-stone-500",children:"Peças Geradas"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-orange-600"})})}),e.jsx("h3",{className:"text-2xl font-bold text-stone-800 mb-1",children:s!=null&&s.successRate?`${(s.successRate*100).toFixed(1)}%`:"0%"}),e.jsx("p",{className:"text-sm text-stone-500",children:"Taxa de Sucesso"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-bronze-100 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-bronze-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:"Qualidade do Serviço"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-stone-600",children:"Tempo Médio de Resposta"}),e.jsx("span",{className:"text-sm font-semibold text-stone-800",children:s!=null&&s.averageResponseTime?`${s.averageResponseTime.toFixed(2)}s`:"N/A"})]}),e.jsx("div",{className:"h-2 bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500",style:{width:`${Math.min(((s==null?void 0:s.averageResponseTime)||0)/10*100,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-stone-600",children:"Taxa de Sucesso"}),e.jsx("span",{className:"text-sm font-semibold text-stone-800",children:s!=null&&s.successRate?`${(s.successRate*100).toFixed(1)}%`:"0%"})]}),e.jsx("div",{className:"h-2 bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500",style:{width:`${((s==null?void 0:s.successRate)||0)*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-stone-600",children:"Taxa de Erro"}),e.jsx("span",{className:"text-sm font-semibold text-stone-800",children:s!=null&&s.errorRate?`${(s.errorRate*100).toFixed(1)}%`:"0%"})]}),e.jsx("div",{className:"h-2 bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500",style:{width:`${((s==null?void 0:s.errorRate)||0)*100}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:"Custos de Operação"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-3xl font-bold text-stone-800 mb-1",children:["$",n!=null&&n.totalCost?n.totalCost.toFixed(2):"0.00"]}),e.jsx("p",{className:"text-sm text-stone-500",children:"Custo total do período"})]}),n!=null&&n.costByModel&&n.costByModel.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-stone-600 mb-2",children:"Custo por Modelo:"}),n.costByModel.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-stone-600",children:t.model}),e.jsxs("span",{className:"text-sm font-semibold text-stone-800",children:["$",t.cost.toFixed(2)]})]},l))]}):e.jsx("p",{className:"text-sm text-stone-400",children:"Nenhum dado de custo disponível"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:"Top Usuários"})]}),a!=null&&a.topUsers&&a.topUsers.length>0?e.jsx("div",{className:"space-y-3",children:a.topUsers.slice(0,5).map((t,l)=>{var c;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-bronze-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-bronze-700",children:((c=t.name)==null?void 0:c.substring(0,2).toUpperCase())||"U"})}),e.jsx("span",{className:"text-sm font-medium text-stone-700",children:t.name||"Usuário"})]}),e.jsxs("span",{className:"text-sm font-semibold text-stone-800",children:[t.count||0," usos"]})]},l)})}):e.jsx("p",{className:"text-sm text-stone-400",children:"Nenhum dado disponível"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(f,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:"Prompts Mais Usados"})]}),a!=null&&a.topPrompts&&a.topPrompts.length>0?e.jsx("div",{className:"space-y-3",children:a.topPrompts.slice(0,5).map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-stone-700",children:t.name||"Prompt"}),e.jsxs("span",{className:"text-sm font-semibold text-stone-800",children:[t.count||0," usos"]})]},l))}):e.jsx("p",{className:"text-sm text-stone-400",children:"Nenhum dado disponível"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-stone-800",children:"Peças Recentes"})]}),r&&r.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-stone-100",children:[e.jsx("th",{className:"text-left text-sm font-medium text-stone-600 pb-3",children:"Data"}),e.jsx("th",{className:"text-left text-sm font-medium text-stone-600 pb-3",children:"Tipo"}),e.jsx("th",{className:"text-left text-sm font-medium text-stone-600 pb-3",children:"Usuário"}),e.jsx("th",{className:"text-left text-sm font-medium text-stone-600 pb-3",children:"Status"})]})}),e.jsx("tbody",{children:r.slice(0,10).map((t,l)=>e.jsxs("tr",{className:"border-b border-stone-50",children:[e.jsx("td",{className:"py-3 text-sm text-stone-700",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("pt-BR"):"N/A"}),e.jsx("td",{className:"py-3 text-sm text-stone-700",children:t.type||"Documento"}),e.jsx("td",{className:"py-3 text-sm text-stone-700",children:t.user||"Sistema"}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="error"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:t.status||"pending"})})]},l))})]})}):e.jsx("p",{className:"text-sm text-stone-400",children:"Nenhuma peça gerada ainda"})]})]})})})]})]}):null}export{q as ReportsPage};
