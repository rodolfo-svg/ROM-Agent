import{j as a}from"./ui-DIb4OZiY.js";import{e as T,a as i}from"./vendor-Dc3V-jfM.js";import{u as w,S as $}from"./Sidebar-BnL4kc_2.js";import{u as B,E as F,M as L,C as V,A as q,c as z}from"./api-DNyTDdnk.js";import"./index-KsEwBOLC.js";function O(){const{conversationId:d}=T(),p=i.useRef(null),m=i.useRef(null),{conversations:f,activeConversationId:c,loadConversations:E,createConversation:v,selectConversation:S,addMessage:j,updateMessage:u,isStreaming:I,setStreaming:x,selectedModel:y}=w(),{artifacts:b,addArtifact:M}=B(),s=f.find(e=>e.id===c),C=()=>{var e;(e=p.current)==null||e.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{C()},[s==null?void 0:s.messages]),i.useEffect(()=>{E()},[]),i.useEffect(()=>{d&&d!==c&&S(d)},[d]),i.useEffect(()=>{c&&s&&s.messages.length===0&&S(c)},[c,f.length]),i.useEffect(()=>{!s&&f.length===0&&v()},[f.length]);const A=e=>b.filter(l=>l.messageId===e),h=async(e,l)=>{let o=c;o||(o=(await v()).id),j({role:"user",content:e});const n=j({role:"assistant",content:"",isStreaming:!0,model:y});x(!0);let g="";try{m.current=new AbortController;const r=f.find(t=>t.id===o),N=(r==null?void 0:r.messages.map(t=>({role:t.role,content:t.content})))||[];for await(const t of z(e,{conversationId:o,model:y,messages:N,signal:m.current.signal}))if(t.type==="chunk"&&t.content)g+=t.content,u(n.id,g);else if(t.type==="artifact"&&t.artifact){const P=M({title:t.artifact.title,type:t.artifact.type,content:t.artifact.content,language:t.artifact.language,messageId:n.id});w.getState().addArtifactToMessage(n.id,P.id)}else t.type==="error"&&(g=`❌ ${t.error}`,u(n.id,g))}catch(r){r.name!=="AbortError"&&u(n.id,`❌ Erro: ${r.message}`)}finally{x(!1),m.current=null}},R=()=>{var e;(e=m.current)==null||e.abort(),x(!1)},k=async e=>{const l=(s==null?void 0:s.messages)||[],o=l.findIndex(n=>n.id===e);if(o>0){const n=l[o-1];n.role==="user"&&await h(n.content)}};return a.jsxs("div",{className:"h-screen flex bg-stone-50 overflow-hidden",children:[a.jsx($,{}),a.jsxs("div",{className:"flex-1 flex flex-col min-w-0 max-md:w-full",children:[a.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain webkit-overflow-scrolling-touch pb-safe",children:!s||s.messages.length===0?a.jsx(F,{onSuggestionClick:h}):a.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 max-md:px-3 max-md:py-4",children:[s.messages.map((e,l)=>a.jsx(L,{message:e,artifacts:A(e.id),onRegenerate:e.role==="assistant"&&!e.isStreaming?()=>k(e.id):void 0},e.id)),a.jsx("div",{ref:p})]})}),a.jsx("div",{className:"flex-shrink-0 pb-safe",children:a.jsx(V,{onSend:h,isLoading:I,onStop:R})})]}),a.jsx(q,{})]})}export{O as ChatPage};
